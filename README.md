# Чарльз Прокси - мобильный гид
Руководство мобильных хакеров по Чарльзу Прокси: большой палец вверх:

## Вступление

[Чарльз](https://www.charlesproxy.com /) - это HTTP-прокси / HTTP monitor / Обратный прокси, который позволяет разработчику просматривать весь HTTP- и SSL / HTTPS-трафик между их компьютером и Интернетом. Сюда входят запросы, ответы и HTTP-заголовки (которые содержат файлы cookie и информацию о кэшировании).

## SSL-прокси

### Компьютер (macOS)

* **Charles** -> **Прокси** -> **Настройки прокси-сервера SSL ...** -> **Прокси-сервер SSL**
 * Установите флажок "**Включить прокси-сервер SSL**".
 * Добавить сопоставитель местоположения "**Хост: &ast;**", "**орт: &ast;**"
    
 <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/SSL-Proxying-Settings.png"/>
    
* **Charles** -> **Справка** -> **Проксирование SSL** -> **Установка корневого сертификата Charles**
 * Он установит сертификат в **Keychain** и автоматически откроет его
 * Дважды щелкните сертификат в связке ключей
 * Разверните **Доверие**, выберите **Всегда доверять** для **При использовании этого сертификата**
    
 <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/Root-Certificate-not-trusted.png"/>
    
<img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/Root-Certificate-trusted.png"/>
    
* Получить **IP-адрес**, который прослушивает Чарльз
 * **Чарльз** -> **Справка** -> **Локальный IP-адрес**
 * Или получить IP-адрес WLAN через командную строку (прямо в буфер обмена)

### Android

* Запустите **Charles** и продолжайте работать
* Получить **IP-адрес**
* Убедитесь, что устройство Android использует ту же сеть, что и Charles
* На **Android** устройстве
 * Перейдите в **Настройки** -> **Wi-Fi** -> длительное нажатие на **сеть** в использовании -> **Изменить сеть** -> **Дополнительные параметры** -> **Прокси** -> **Руководство**
 * **Имя хоста прокси-сервера** = **IP-адрес**
 * **Прокси-порт** = **8888**
        
  <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/Wi-Fi.png"/>
  
    
 * Запустите **Браузер**, посетите https://chls.pro/ssl , сохраните сертификат
    
 <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/certificate.png"/>
    
 * Система попросит вас установить экран блокировки **PIN-код** или **пароль**, просто установите один и сохраните его
 * Теперь сертификат установлен
 * Откройте приложение и отслеживайте трафик на Charles
* На компьютере появляется диалоговое окно с запросом "Попытка подключения к Charles была предпринята с хоста ...", просто нажмите **Разрешить** кнопка

#### Android N (7.0, уровень API 24) и впоследствии

* Откройте свой проект Android с помощью Android Studio
* **Android Studio** -> **Файл** -> **Новый** -> **Каталог ресурсов Android**
 * **Имя каталога** = **xml**
 * **Тип каталога** = **xml**
 * **Набор исходных текстов** = **отладка**
* **Android Studio** -> **Файл** -> **Новый** -> **XML-файл ресурсов**
 * **Имя файла** = **network_security_config**
 * **Корневой элемент** = **network-security-config**
* На предыдущем шаге будет сгенерирован XML-файл с заданным корневым элементом. Теперь вставьте содержимое ниже, чтобы заменить существующее содержимое в сгенерированном XML-файле.
*  ``xml
*  <?xml version="1.0" encoding="utf-8"?>
 * <network-security-config xmlns:android="http://schemas.android.com/apk/res/android ">
 * <debug-переопределяет>
 * <якоря доверия>
 * <!-- Trust user added CAs while debuggable only -->
 * <сертификаты src="user" />
 * </ якоря доверия>
 * </debug-переопределяет>
 * </network-security-config>
    ```
* Затем перейдите к **debug** исходному набору, создайте пробел **AndroidManifest.xml ** файл, если у вас его нет для варианта сборки debug, и добавьте содержимое, как показано ниже (в конечном итоге слияние манифеста объединит его с основным манифестом). Если он у вас уже есть, просто добавьте атрибут networkSecurityConfig в разделе `приложение`.
 ``xml
 * <?xml version="1.0" encoding="utf-8"?>
 * xmlns:инструменты="http://schemas.android.com/tools ">
 * android: networkSecurityConfig="@xml/network_security_config">
 * </application>  
 * </manifest>
    ```

Теперь прокси-сервер SSL должен работать для варианта сборки debug вашего приложения, но не для варианта сборки release.

### iOS

* Запустите **Charles** и продолжайте работать
* Получить **IP-адрес**
* Убедитесь, что устройство iOS использует ту же сеть, что и Charles
* На **устройстве iOS**
 * Перейдите в **Настройки * -> **Wi-Fi** -> выберите **сеть** в использовании -> установите **HTTP-ПРОКСИ** на **Руководство**
 * **Сервер** = **IP-адрес**
 * **Порт** = **8888**
        
 <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/Wi-Fi%20(1).png"/>
    
 * Запустите **Safari**, посетите https://chls.pro/ssl (если это не сработает, попробуйте http://www.charlesproxy.com/getssl ), установите сертификат
    
  <img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/certificate%20(1).png"/>
    
 * Откройте приложение и отслеживайте трафик на Charles
* На компьютере появляется диалоговое окно с запросом "Попытка подключения к Charles была предпринята с хоста ...", просто нажмите **Разрешить** кнопка

#### iOS 10.3 и последующие версии

* После установки сертификата
* Перейдите в **Настройки** -> **Общие** -> **О программе** -> **Настройки доверия сертификатов** -> **Включить полное доверие для корневых сертификатов** -> включить сертификат Чарльза

<img src="https://github.com/NadiDU/Charles/blob/main/icon-charles/Certificate-Trust-Settings.png"/>

### Терминал

На случай, если вам нужно выполнить отладку через curl в терминале:

* Чтобы установить Charles в качестве прокси-сервера

 `оболочка
 экспорт http_proxy=http://127.0.0.1:8888 && экспорт https_proxy=$http_proxy
    ```

* Для удаления прокси

 `оболочка
 отключить http_proxy https_proxy
    ```

### Сертификат SSL CA

* Прокси-сервер Charles, запущенный на том же компьютере, предоставляет тот же SSL-сертификат.
